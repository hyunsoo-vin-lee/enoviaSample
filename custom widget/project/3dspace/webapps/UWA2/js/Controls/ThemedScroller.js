define("UWA/Controls/ThemedScroller",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Controls/Abstract","UWA/Controls/Drag","UWA/Class/Timed"],function(e,i,c,f,k,g){var h=false;function d(){if(h!==false){return h}var m=e.createElement("div",{"class":"uwa-themed-scroller-content no-native-scrollbars",styles:{width:"100px",height:"100px",position:"absolute",visibility:"hidden",top:"0",left:"0",overflow:"scroll"}});document.body.appendChild(m);h=m.offsetWidth-m.clientWidth;document.body.removeChild(m);return h}function b(q){if(q.event){q=q.event}var o=q.changedTouches||q.touches||[q];var m={x:0,y:0};var n=o.length;var p;for(p=0;p<n;p++){m.x+=o[p].clientX/n;m.y+=o[p].clientY/n}return m}var l={delta:0,coef:1,active:false,visible:false,scrollSize:0,scrollPosition:0,offsetSize:0};var a=k.extend({defaultOptions:{touchSnap:0,touchDelay:0},init:function(m,n){this._parent(n);this.scroller=m;this.direction=this.element.className.contains("scrollbar-y")?"y":"x"},_getInfos:function(){return this.scroller._infos[this.direction]},_getPosition:function(){var m=this.element.getBoundingClientRect()[this.direction==="y"?"top":"left"];return b(this.currentEvent)[this.direction]-m},start:function(m){this._parent(m);this._getInfos().active=true;this.scroller.update();this.position=this._getPosition()},move:function(m,o){this._parent(m,o);var n=this._getInfos();n.delta=(this._getPosition()-this.position)*n.coef;n.active=true;this.scroller.updateVisible()},stop:function(){this._parent();this.scroller.updateActive(this.currentEvent)}});var j=f.extend(g,{name:"uwa-themed-scroller",options:{element:null,scrollbars:"auto",scrollbarsMargin:4,scrollbarsMinSize:50,shadows:false},init:function(m){if(e.is(m)&&e.is(m.element)){e.extendElement(m.element)}this._parent(m);this._elementEvents={mousemove:this.updateActive.bind(this),mouseout:this.updateActive.bind(this)};if(this.options.scrollbars==="auto"){this.options.scrollbars=d()===0?"native":"virtual"}this._buildElements();this._initElements();this.initInfos()},initInfos:function(){this._infos={x:Object.create(l),y:Object.create(l)};this.setPeriodical("update",this.update,1000);this.update()},destroy:function(){if(this.options.element){var m=this.elements.container;m.removeEvents(this._elementEvents).removeClassName(this.getClassNames()).setContent(this.elements.content.childNodes);var n=m.destroy;m.destroy=function(){};this._parent();m.destroy=n}else{this._parent()}},onInjected:function(){this.initInfos()},_buildElements:function(){var m=this.options.element||e.createElement("div");this.elements.container=m;this.elements.content=e.createElement("div",{html:m.childNodes}).inject(m)},_initElements:function(){var m=this.elements.container;var o=this.elements.content;m.addClassName(this.getClassNames()).addEvents(this._elementEvents);var n=this.options.scrollbars==="native";var p=n?"native-scrollbars ":"no-native-scrollbars ";o.addClassName(p+this.getClassNames("-content")).addEvent("scroll",this.updateVisible.bind(this));if(!n){o.setStyles({right:-d(),bottom:-d()})}},getInnerElement:function(){return this.elements.content},getScrollbar:function(m,n){var o=this.elements[m+"Scrollbar"];if(!o&&n){o=this.elements[m+"Scrollbar"]=e.createElement("div",{"class":this.getClassNames("-scrollbar","-scrollbar-"+m)}).inject(this.elements.container);new a(this,{element:o,root:this.elements.container});o.clientHeight}return o},getShadow:function(m,n){var o=this.elements[m+"Shadow"];if(!o&&n){o=this.elements[m+"Shadow"]=e.createElement("div",{"class":this.getClassNames("-shadow","-shadow-"+m)}).inject(this.elements.container)}return o},showShadow:function(m,n){var p=this.getShadow(m,n);var o=100;if(n){if(n>o){n=o}p.setStyle("opacity",n/o).addClassName("active")}else{if(p){p.removeClassName("active")}}},updateActive:function(p){if(this.options.scrollbars!=="virtual"){return}function n(s,r,t){return s<r&&r<t}if(p.type==="mouseout"||p.type==="touchend"){this._infos.x.active=this._infos.y.active=false}else{var o=this.elements.container.getBoundingClientRect();var q=12;var m=b(p);["x","y"].forEach(function(s,t){var r=o[t?"right":"bottom"];this._infos[s].active=n(r-q,m[t?"x":"y"],r)&&n(o[t?"top":"left"],m[s],o[t?"bottom":"right"])},this)}this.updateVisible()},updateVisible:function(){this._infos.x.visible=this._infos.y.visible=true;this.setDelayed("scrollbars-visible",function(){this._infos.x.visible=this._infos.y.visible=false;this.update()},1000);this.update()},_read:function(p){var o=this._infos[p?"y":"x"];var n=this.elements.content;var m=d();o.scrollSize=n[p?"scrollHeight":"scrollWidth"];o.scrollPosition=n[p?"scrollTop":"scrollLeft"]+o.delta;o.offsetSize=n[p?"offsetHeight":"offsetWidth"]-m;if(o.scrollPosition<0){o.scrollPosition=0}else{if(o.scrollPosition>o.scrollSize-o.offsetSize){o.scrollPosition=o.scrollSize-o.offsetSize}}},_write:function(t){var p=t?"y":"x";var r=this._infos[p];var o=this.options;if(r.delta){this.elements.content[t?"scrollTop":"scrollLeft"]=r.scrollPosition;r.delta=0}if(this.options.scrollbars==="virtual"){var m=r.scrollSize>r.offsetSize+1;var s=this.getScrollbar(p,m);if(m&&r.scrollSize){var n=r.offsetSize-2*o.scrollbarsMargin;var q=(n*(r.offsetSize/r.scrollSize));if(q<o.scrollbarsMinSize){q=o.scrollbarsMinSize}r.coef=(r.scrollSize-r.offsetSize)/(n-q);s.style[t?"top":"left"]=(o.scrollbarsMargin+r.scrollPosition/r.coef)+"px";s.style[t?"height":"width"]=q+"px";s.toggleClassName("active",r.active).toggleClassName("visible",r.visible)}else{if(s){s.removeClassName("active").removeClassName("visible")}}}if(o.shadows&&r.offsetSize){this.showShadow(p+"-start",r.scrollPosition);this.showShadow(p+"-end",r.scrollSize-r.scrollPosition-r.offsetSize)}},update:function(){this.setAnimate("update",function(){this._read(false);this._read(true);if(!e.equals(this._previousInfos,this._infos)){this._write(false);this._write(true);this._previousInfos=e.clone(this._infos)}})}});return e.namespace("Controls/ThemedScroller",j,e)});