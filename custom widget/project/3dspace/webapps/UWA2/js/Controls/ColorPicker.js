define("UWA/Controls/ColorPicker",["UWA/Core","UWA/Event","UWA/Color","UWA/Controls/Picker","UWA/Controls/Drag","UWA/Controls/Input","UWA/String"],function(d,j,a,g,h,f,b){var c=function(m,k){var l=m&&m.match(k?/^\s*#?([0-9a-f]{0,6})/i:/^\s*#?(|[0-9a-f]{3}|[0-9a-f]{6})\s*$/i);return l?l[1]:""};var i=h.extend({defaultOptions:{touchSnap:0,mouseSnap:0},start:function(k){this.move(k,{distance:0,x:0,y:0})},move:function(k,p){var n=this.element.getOffsets(),m=this.element.getSize();var l={x:k.x-n.x,y:k.y-n.y};l.x=Math.max(0,Math.min(m.width,l.x));l.y=Math.max(0,Math.min(m.height,l.y));var o={x:l.x/m.width,y:l.y/m.height};this.options.pickCallback(o,l);if(this.options.hideCursorWhileDragging&&p.distance>0&&!this.injectedStylesheet){this.injectedStylesheet=d.createElement("style",{html:"* { cursor: none !important; }"}).inject(document.body)}},reset:function(){if(this.injectedStylesheet){this.injectedStylesheet.remove();this.injectedStylesheet=null}this._parent()}});var e=g.extend({name:"uwa-colorpicker",currentView:null,previouslyDisplayedHue:null,options:{button:{tag:"div","class":"uwa-colorpicker-well"},dropdownOptions:{},defaultValue:null,defaultView:"picker"},panton:["#9E080E","#637235","#942157","#50299A","#1277DB","#101010","#E51A60","#159A2B","#C41F88","#A159CE","#188D92","#444444","#FC7E29","#85BB23","#E868AE","#7970D0","#37C2DB","#888888","#FEB82C","#C6E12F","#E6A6AB","#A98EE5","#7EBBF5","#AAAAAA","#FFD631","#E6FB4D","#F2C99F","#B9B8E0","#C3E1FE","#CCCCCC"],_items:[],init:function(k){this._parent(k);if(/\bdark\b/.test(this.options.className)&&!this.options.dropdownOptions.className){this.options.dropdownOptions.className="dark"}this.elements.well=this.elements.button.getElement(".uwa-colorpicker-well");this._updateWell();this.syncInput()},_getColor:function(){var l=this.getValue()||this.options.defaultValue||"ffffff";if(this._color){var m=a.parse(l);var k=this._color;if(!d.equals(k.toRGBString(),m.toRGBString())){this._color=null}else{return this._color}}return a.parse(l)},_setColor:function(k){this.setValue(k.toHSLString())},_setView:function(l){var k=l||this.options.defaultView;this.previouslyDisplayedHue=undefined;if(k!==this.currentView){this.elements.viewContainer.setContent(this["build"+b.ucfirst(k)+"View"]());this.currentView=k;["panton","picker"].forEach(function(m){this.elements.colorpickerContainer.toggleClassName(m+"-view",m===k)}.bind(this))}return this},setValue:function(k){if(typeof(k)==="string"){k=a.parse(k)}if(!k){return}this._color=k;this._parent(k.toHexString().substring(1))},buildContent:function(){this.elements.colorpickerContainer=d.createElement("div",{"class":this.getClassNames("-container")});this.elements.viewContainer=d.createElement("div",{"class":this.getClassNames("-view-container")});this.elements.colorpickerContainer.addContent(this.elements.viewContainer);this.elements.colorpickerContainer.addContent(this._buildControls());this._setView(this.options.defaultView);return this.elements.colorpickerContainer},buildPickerView:function(){var k=this;var l=d.createElement("div",{html:[this.elements.slPicker=d.createElement("div",{"class":this.getClassNames("-sl-picker"),html:[this.elements.slPickerCanvas=d.createElement("canvas",{"class":this.getClassNames("-sl-picker-canvas"),width:220,height:220}),this.elements.slPickerCursor=d.createElement("div",{"class":this.getClassNames("-sl-picker-cursor")})]}),this.elements.huePicker=d.createElement("div",{"class":this.getClassNames("-hue-picker"),html:[this.elements.huePickerArrows=d.createElement("div",{"class":this.getClassNames("-hue-picker-arrows")}),this.elements.huePickerCanvas=d.createElement("canvas",{"class":this.getClassNames("-hue-picker-canvas"),width:26,height:220})]})]});new i({element:this.elements.slPicker,hideCursorWhileDragging:true,pickCallback:function(q){var p=q.x,n=(1-q.y);var m=(2-p)*n;var o;if(n>0){o=p*n;o/=m<=1?m:2-m;o=o||0;m/=2}else{o=q.x}m*=100;o*=100;k._setColor(k._getColor().cloneWith({l:m,s:o}))}});new i({element:this.elements.huePicker,pickCallback:function(m){k._setColor(k._getColor().cloneWith({h:(1-m.y)*360}))}});this.elements.hexField.getElement(".uwa-input-hex-field input").addEvents({keyup:function(){k._readInputFieldValue()},input:function(){k._readInputFieldValue()},change:function(){k._readInputFieldValue()}});this.elements.dropdown.getInnerElement().addEvent("mousedown",function(m){if(m.target!==k.elements.hexFieldInput.getInputElement()){j.preventDefault(m)}});this._renderHuePicker();this.syncInput();return l},buildPantonView:function(){var k=this;k.elements.pantonContainer=d.createElement("div",{"class":k.getClassNames("-panton-container")});k._items=[];this.panton.forEach(function(l){var m=d.createElement("span",{"class":k.getClassNames("-item-content"),styles:{background:l},events:{click:function(){k.dispatchEvent("resetPantonSelection");this.addClassName("active");k._setColor(a.parse(l))}}});d.createElement("div",{"class":k.getClassNames("-item"),html:[m]}).inject(k.elements.pantonContainer);k._items.push(m)});this.elements.dropdown.getInnerElement().addEvent("mousedown",function(l){if(l.target!==k.elements.hexFieldInput.getInputElement()){j.preventDefault(l)}});return k.elements.pantonContainer},_buildControls:function(){var l=this,m=/\bdark\b/.test(this.options.className);var k=d.createElement("div",{"class":this.getClassNames("-controls"),html:[d.createElement("div",{"class":this.getClassNames("-panton-button"),events:{mousedown:function(n){j.preventDefault(n)},click:function(n){j.preventDefault(n);l._setView("panton")}}}),d.createElement("div",{"class":this.getClassNames("-picker-button"),events:{mousedown:function(n){j.preventDefault(n)},click:function(n){j.preventDefault(n);l._setView("picker")}}}),this.elements.hexField=d.createElement("div",{"class":this.getClassNames("-hex-field"),html:[this.elements.hexFieldInput=new f.Text({_root:false,className:this.getClassNames("-hex-field-input")}),d.createElement("span",{"class":this.getClassNames("-hex-field-icon"),text:"#"})]}),this.elements.clearButton=d.createElement("div",{"class":this.getClassNames("-clear-button")+" uwa-icon","data-icon":"p",events:{mousedown:function(n){j.preventDefault(n)},click:function(n){j.preventDefault(n);l.setValue(l.options.defaultValue)}}}),new f.Button({_root:false,value:"Done",className:this.getClassNames("-done-button")+(m?" extra-dark-grey":" dark-grey"),events:{onMouseDown:function(n){j.preventDefault(n)},onClick:function(){l.toggle(false)}}})]});return k},resetPantonSelection:function(){var k=this._items;for(var l=0;l<k.length;l++){k[l].removeClassName("active")}},_renderHuePicker:function(){var p=37;var m=this.elements.huePickerCanvas,n=this.elements.huePickerCanvas.getContext("2d");var q=n.createLinearGradient(0,0,0,m.height);for(var l=0;l<p;l++){var o=l/(p-1);var k=a.parse("hsl("+((1-o)*360)+", "+100+"%, "+50+"%)");q.addColorStop(o,k.toHSLString())}n.fillStyle=q;n.fillRect(0,0,m.width,m.height)},_updateWell:function(){this.elements.well.setStyle("background",this._getColor().toHSLString())},_updateSlPicker:function(){var l=this.elements.slPickerCanvas;var k=this.elements.slPickerCanvas.getContext("2d");var p=this._getColor();var t=p.toObject();if(this.previouslyDisplayedHue!==t.h){this.previouslyDisplayedHue=t.h;var v=k.createLinearGradient(0,0,l.width,0);var q=a.parse("hsl("+t.h+", "+100+"%, "+50+"%)");v.addColorStop(0,"white");v.addColorStop(1,q.toHSLString());k.fillStyle=v;k.fillRect(0,0,l.width,l.height);var s=k.createLinearGradient(0,0,0,l.height);s.addColorStop(0,"transparent");s.addColorStop(1,"black");k.fillStyle=s;k.fillRect(0,0,l.width,l.height)}var n=this.elements.slPickerCursor,r,u,o,m;r=t.l/100*2;u=t.s/100*((r<=1)?r:2-r);m=(r+u)/2;if(r>0){o=(2*u)/(r+u)}else{o=t.s/100}o=Math.round(o*this.elements.slPickerCanvas.width);m=Math.round((1-m)*this.elements.slPickerCanvas.height);n.setStyle("left",o+"px");n.setStyle("top",m+"px");n.setStyle("background",p.toHexString())},_updateHuePicker:function(){var l=this.elements.huePickerArrows;var k=(360-this._getColor().toObject().h)/360;var m=k*this.elements.huePickerCanvas.height;l.setStyle("top",Math.round(m)+"px")},_updateHexField:function(){var k=this.elements.hexFieldInput;if(this.getValue()){var m=this._getColor();var l=a.parse(k.getValue());if(!l||!d.equals(m.toRGBString(),l.toRGBString())){k.setValue(m.toHexString().substring(1))}}else{k.setValue("")}},_updateDefaultButton:function(){this.elements.clearButton.toggle(d.is(this.options.defaultValue)&&this.options.defaultValue!==this.getValue())},syncInput:function(){if(this.elements.well){this._updateWell()}if(this.elements.slPicker){this._updateSlPicker();this._updateHuePicker();this._updateHexField();this._updateDefaultButton()}if(this.elements.value){var k=this.getValue();k=k?k.toLowerCase():"";this.elements.value.setText(k)}},_readInputFieldValue:function(){var m=this.elements.hexFieldInput.getValue();var n=c(m,true);if(n!==m){this.elements.hexFieldInput.setValue(n)}if(n.length===3||n.length===6){var l=n.replace(/-/g,"Z");var k=a.parse(l);this.setValue(k)}},toggle:function(k){this._parent.apply(this,arguments);if(k===false){this._dispatchOnChange()}}});return d.namespace("Controls/ColorPicker",e,d)});